
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="quantstrip.html">
      
      
        <link rel="next" href="email.html">
      
      
      <link rel="icon" href="../assets/Q_logo.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>db_handler - Documentation 0.94</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../styles/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="github" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#database-handler" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Documentation 0.94" class="md-header__button md-logo" aria-label="Documentation 0.94" data-md-component="logo">
      
  <img src="../assets/Logo_all_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation 0.94
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              db_handler
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Documentation 0.94" class="md-nav__button md-logo" aria-label="Documentation 0.94" data-md-component="logo">
      
  <img src="../assets/Logo_all_white.png" alt="logo">

    </a>
    Documentation 0.94
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Basic Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Basic Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dashboard Apps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Dashboard Apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/client_monitor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client Monitor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/python_editor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Editor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/email.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/SQL_database.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SQL Database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/logging.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_examples/templates_general.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Broker Integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Broker Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_examples/IBKR_template.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interactive Brokers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Strategy Templates
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Strategy Templates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_examples/monthly_rebalancing.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monthly Rebalancing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quantstrip.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantstrip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    db_handler
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="database.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    db_handler
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#db_handler" class="md-nav__link">
    <span class="md-ellipsis">
      db_handler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="db_handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization-and-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization and Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-an-sql-query" class="md-nav__link">
    <span class="md-ellipsis">
      Running an SQL Query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-id-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Order ID Generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-management" class="md-nav__link">
    <span class="md-ellipsis">
      Order Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-status-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Order Status Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategy-event-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Event Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#position-event-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Position Event Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-position-management" class="md-nav__link">
    <span class="md-ellipsis">
      External Position Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commission-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Commission Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-management" class="md-nav__link">
    <span class="md-ellipsis">
      Broker Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategy-management" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reporting-system" class="md-nav__link">
    <span class="md-ellipsis">
      Reporting System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-account-management" class="md-nav__link">
    <span class="md-ellipsis">
      Email Account Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-report-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Report Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-order-workflow-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Order Workflow Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#position-reconciliation-example" class="md-nav__link">
    <span class="md-ellipsis">
      Position Reconciliation Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-tables-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Database Tables Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Tables Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-trading-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Core Trading Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Reference Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reporting-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Reporting Tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Key Design Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event-based-position-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Event-Based Position Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#append-only-order-status" class="md-nav__link">
    <span class="md-ellipsis">
      Append-Only Order Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-metadata-storage" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Metadata Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thread-safety-and-connection-pooling" class="md-nav__link">
    <span class="md-ellipsis">
      Thread Safety and Connection Pooling
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="email.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    email_manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="logging.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    logging
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#db_handler" class="md-nav__link">
    <span class="md-ellipsis">
      db_handler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="db_handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization-and-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization and Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-an-sql-query" class="md-nav__link">
    <span class="md-ellipsis">
      Running an SQL Query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-id-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Order ID Generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-management" class="md-nav__link">
    <span class="md-ellipsis">
      Order Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-status-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Order Status Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategy-event-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Event Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#position-event-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Position Event Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-position-management" class="md-nav__link">
    <span class="md-ellipsis">
      External Position Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commission-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Commission Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-management" class="md-nav__link">
    <span class="md-ellipsis">
      Broker Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategy-management" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reporting-system" class="md-nav__link">
    <span class="md-ellipsis">
      Reporting System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-account-management" class="md-nav__link">
    <span class="md-ellipsis">
      Email Account Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-report-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Report Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-order-workflow-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Order Workflow Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#position-reconciliation-example" class="md-nav__link">
    <span class="md-ellipsis">
      Position Reconciliation Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-tables-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Database Tables Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Tables Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-trading-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Core Trading Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Reference Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reporting-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Reporting Tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Key Design Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event-based-position-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Event-Based Position Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#append-only-order-status" class="md-nav__link">
    <span class="md-ellipsis">
      Append-Only Order Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-metadata-storage" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Metadata Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thread-safety-and-connection-pooling" class="md-nav__link">
    <span class="md-ellipsis">
      Thread Safety and Connection Pooling
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="database-handler">Database Handler</h1>
<h2 id="db_handler"><code>db_handler</code></h2>
<p>The <code>db_handler</code> is a thread-safe singleton that manages all database operations for the Quantstrip trading system. It uses connection pooling for efficient concurrent access and implements the singleton pattern to ensure only one database handler exists per application instance.</p>
<div class="admonition info">
<p class="admonition-title">Key Features</p>
<ul>
<li>Thread-safe operations with connection pooling</li>
<li>Singleton pattern for shared database access</li>
<li>Time-based order ID generation</li>
<li>Canonical order and execution tracking with metadata support</li>
<li>Event-based position tracking (position_event and strategy_event)</li>
<li>External position reconciliation</li>
<li>Comprehensive reporting system with email account management</li>
</ul>
</div>
<hr />
<h3 id="initialization-and-connection">Initialization and Connection</h3>
<p>Import <code>db_handler</code> from <code>quantstrip</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">quantstrip</span><span class="w"> </span><span class="kn">import</span> <span class="n">db_handler</span> <span class="k">as</span> <span class="n">db</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_connection</strong>()</span></p>
<p>Context manager that retrieves a connection from the pool. This is the primary way to interact with the database directly.</p>
<p><strong>Returns:</strong> Database connection object</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM broker&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The connection pool automatically manages connection lifecycle, returning connections to the pool when done or creating temporary connections if the pool is exhausted.</p>
</div>
<hr />
<h3 id="running-an-sql-query">Running an SQL Query</h3>
<p><span class="funcname"><strong>run_query</strong>(sql_str, params=())</span></p>
<p>Executes a SELECT query and returns results as a pandas DataFrame. This is the recommended way to retrieve data from the database.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sql_str</code></td>
<td><code>str</code></td>
<td>SQL query string</td>
</tr>
<tr>
<td><code>params</code></td>
<td><code>tuple</code></td>
<td>Query parameters for safe parameterized queries</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with query results</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT * FROM execution WHERE order_id = ?&quot;</span><span class="p">,</span> 
    <span class="p">(</span><span class="mi">12345</span><span class="p">,)</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="order-id-generation">Order ID Generation</h3>
<p><span class="funcname"><strong>next_order_id</strong>()</span>
Generates a strictly monotonic increasing order ID based on seconds since epoch (2020-01-01). This method is both thread-safe and process-safe.</p>
<p><strong>Returns:</strong> <code>int</code> - Order ID (9 digits maximum)</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">order_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">next_order_id</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New order: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># e.g., 163847291</span>
</code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">How It Works</p>
<ol>
<li>Calculates seconds since epoch (2020-01-01)</li>
<li>Retrieves last used ID from database</li>
<li>Ensures new ID is strictly greater than last ID</li>
<li>Persists new ID to database for process safety</li>
<li>Handles edge cases like same-second calls or manual orders</li>
<li>Raises OverflowError if ID exceeds 9 digits</li>
</ol>
</div>
<hr />
<h3 id="order-management">Order Management</h3>
<p><span class="funcname"><strong>insert_order</strong>(order_id, strategy_id, broker_id, account, symbol, side, order_type, total_quantity, limit_price=None, stop_price=None, trail_amount=None, instrument_type=None, parent_order_id=None, client_reference=None, external_order_id=None, metadata=None)</span>
Insert a canonical order record. The order_id is the Quantstrip-generated time-based ID from <code>next_order_id()</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Quantstrip order ID (from next_order_id())</td>
</tr>
<tr>
<td><code>strategy_id</code></td>
<td><code>int</code></td>
<td>Strategy placing the order</td>
</tr>
<tr>
<td><code>broker_id</code></td>
<td><code>int</code></td>
<td>Broker to execute the order</td>
</tr>
<tr>
<td><code>account</code></td>
<td><code>str</code></td>
<td>Trading account identifier</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Trading symbol</td>
</tr>
<tr>
<td><code>side</code></td>
<td><code>str</code></td>
<td>'BUY' or 'SELL'</td>
</tr>
<tr>
<td><code>order_type</code></td>
<td><code>str</code></td>
<td>MKT, LMT, STOP, STOP_LIMIT, IOC, FOK, TRAILING, etc.</td>
</tr>
<tr>
<td><code>total_quantity</code></td>
<td><code>float</code></td>
<td>Number of shares/contracts (always positive)</td>
</tr>
<tr>
<td><code>limit_price</code></td>
<td><code>float</code></td>
<td>Limit price (for limit orders)</td>
</tr>
<tr>
<td><code>stop_price</code></td>
<td><code>float</code></td>
<td>Stop price (for stop orders)</td>
</tr>
<tr>
<td><code>trail_amount</code></td>
<td><code>float</code></td>
<td>Trail amount (for trailing stops)</td>
</tr>
<tr>
<td><code>instrument_type</code></td>
<td><code>str</code></td>
<td>STOCK, CRYPTO, FUTURE, OPTION</td>
</tr>
<tr>
<td><code>parent_order_id</code></td>
<td><code>int</code></td>
<td>Parent order ID (for bracket orders)</td>
</tr>
<tr>
<td><code>client_reference</code></td>
<td><code>str</code></td>
<td>Client-provided reference/orderRef</td>
</tr>
<tr>
<td><code>external_order_id</code></td>
<td><code>str</code></td>
<td>Broker's order ID (IB orderId, Binance orderId)</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>dict</code></td>
<td>Extra broker-specific fields (stored as JSON)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>int</code> - order_id</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate order ID</span>
<span class="n">order_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">next_order_id</span><span class="p">()</span>

<span class="c1"># Create order record</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">account</span><span class="o">=</span><span class="s2">&quot;U1234567&quot;</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
    <span class="n">order_type</span><span class="o">=</span><span class="s2">&quot;LMT&quot;</span><span class="p">,</span>
    <span class="n">total_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">limit_price</span><span class="o">=</span><span class="mf">150.50</span><span class="p">,</span>
    <span class="n">instrument_type</span><span class="o">=</span><span class="s2">&quot;STOCK&quot;</span><span class="p">,</span>
    <span class="n">client_reference</span><span class="o">=</span><span class="s2">&quot;tech_basket_entry&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;signal_type&quot;</span><span class="p">:</span> <span class="s2">&quot;momentum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;entry_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-01-17&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>update_order_external_id</strong>(order_id, external_order_id)</span>
Update the broker-assigned permanent order ID. This links the Quantstrip order_id with the broker's order ID.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Quantstrip order ID</td>
</tr>
<tr>
<td><code>external_order_id</code></td>
<td><code>str</code></td>
<td>Broker's permanent order ID</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># After placing order with broker</span>
<span class="n">db</span><span class="o">.</span><span class="n">update_order_external_id</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span> <span class="n">external_order_id</span><span class="o">=</span><span class="s2">&quot;1234567890&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_order</strong>(order_id=None, strategy_id=None, symbol=None)</span>
Get order records with flexible filtering.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Filter by order ID (optional)</td>
</tr>
<tr>
<td><code>strategy_id</code></td>
<td><code>int</code></td>
<td>Filter by strategy (optional)</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Filter by symbol (optional)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with order details</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Get specific order</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="mi">163847291</span><span class="p">)</span>

<span class="c1"># Get all orders for a strategy and symbol</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order</span><span class="p">(</span><span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>

<span class="c1"># Get all orders for a strategy</span>
<span class="n">strategy_orders</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order</span><span class="p">(</span><span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get all orders</span>
<span class="n">all_orders</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<h3 id="order-status-tracking">Order Status Tracking</h3>
<p><span class="funcname"><strong>insert_order_status</strong>(order_id, status, filled_quantity=None, remaining_quantity=None, avg_fill_price=None, last_fill_price=None, external_order_id=None, client_reference=None, parent_order_id=None, reason_held=None, cap_price=None, metadata=None, event_time=None)</span>
Insert a new order status event. This does NOT update previous rows - every broker status transition becomes a new row for complete audit trail.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Order ID (foreign key to orders table)</td>
</tr>
<tr>
<td><code>status</code></td>
<td><code>str</code></td>
<td>NEW, SUBMITTED, PARTIALLY_FILLED, FILLED, CANCELLED, REJECTED, etc.</td>
</tr>
<tr>
<td><code>filled_quantity</code></td>
<td><code>float</code></td>
<td>Total filled so far</td>
</tr>
<tr>
<td><code>remaining_quantity</code></td>
<td><code>float</code></td>
<td>Remaining amount</td>
</tr>
<tr>
<td><code>avg_fill_price</code></td>
<td><code>float</code></td>
<td>Weighted avg fill price so far</td>
</tr>
<tr>
<td><code>last_fill_price</code></td>
<td><code>float</code></td>
<td>Price of the last fill event</td>
</tr>
<tr>
<td><code>external_order_id</code></td>
<td><code>str</code></td>
<td>Broker's order ID</td>
</tr>
<tr>
<td><code>client_reference</code></td>
<td><code>str</code></td>
<td>Client-provided reference</td>
</tr>
<tr>
<td><code>parent_order_id</code></td>
<td><code>int</code></td>
<td>For brackets/OCO/etc.</td>
</tr>
<tr>
<td><code>reason_held</code></td>
<td><code>str</code></td>
<td>IBKR whyHeld (e.g., "locate")</td>
</tr>
<tr>
<td><code>cap_price</code></td>
<td><code>float</code></td>
<td>IBKR market cap price or Binance price cap</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>dict</code></td>
<td>Broker-specific extras (stored as JSON)</td>
</tr>
<tr>
<td><code>event_time</code></td>
<td><code>str</code></td>
<td>Broker timestamp (else defaults to now)</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># When orderStatus callback is received</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order_status</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;SUBMITTED&quot;</span><span class="p">,</span>
    <span class="n">filled_quantity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">remaining_quantity</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="c1"># When order partially fills</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order_status</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;PARTIALLY_FILLED&quot;</span><span class="p">,</span>
    <span class="n">filled_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">remaining_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">avg_fill_price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">last_fill_price</span><span class="o">=</span><span class="mf">150.48</span>
<span class="p">)</span>

<span class="c1"># When order completely fills</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order_status</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;FILLED&quot;</span><span class="p">,</span>
    <span class="n">filled_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">remaining_quantity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">avg_fill_price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">last_fill_price</span><span class="o">=</span><span class="mf">150.49</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_order_status</strong>(order_id=None)</span>
Get all order status events, newest first. Returns complete history of status changes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Filter by order ID (optional)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with order status details</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Get status history for specific order</span>
<span class="n">status_history</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order_status</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="mi">163847291</span><span class="p">)</span>

<span class="c1"># Get all order statuses</span>
<span class="n">all_statuses</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order_status</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_current_order_status</strong>(order_id)</span>
Get only the most recent status for an order.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Order ID to query</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> Single row (dict-like) with latest status, or None</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">current</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_current_order_status</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="mi">163847291</span><span class="p">)</span>
<span class="k">if</span> <span class="n">current</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current status: </span><span class="si">{</span><span class="n">current</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="strategy-event-tracking">Strategy Event Tracking</h3>
<p>Strategy events track intended position changes before they are executed. Used for planning and reconciliation.</p>
<p><span class="funcname"><strong>insert_strategy_event</strong>(order_id, position, event_type, group_label=None, status="PENDING", metadata=None)</span>
Insert a canonical strategy event snapshot.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Associated order ID (unique constraint)</td>
</tr>
<tr>
<td><code>position</code></td>
<td><code>float</code></td>
<td>Intended position size</td>
</tr>
<tr>
<td><code>event_type</code></td>
<td><code>str</code></td>
<td>OPEN, CLOSE, OPEN/CLOSE, FLIP, PARTIAL_CLOSE, etc.</td>
</tr>
<tr>
<td><code>group_label</code></td>
<td><code>str</code></td>
<td>Optional label for grouping related events</td>
</tr>
<tr>
<td><code>status</code></td>
<td><code>str</code></td>
<td>PENDING, EXECUTED, FAILED</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>dict</code></td>
<td>Additional event data (stored as JSON)</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">insert_strategy_event</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
    <span class="n">group_label</span><span class="o">=</span><span class="s2">&quot;tech_basket&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;signal&quot;</span><span class="p">:</span> <span class="s2">&quot;momentum_crossover&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_last_strategy_event</strong>(strategy_id, symbol)</span>
Get the most recent strategy event for a strategy-symbol pair.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategy_id</code></td>
<td><code>int</code></td>
<td>Strategy ID</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Trading symbol</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> Dictionary with event details, or None</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">last_event</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_last_strategy_event</span><span class="p">(</span><span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">last_event</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last event: </span><span class="si">{</span><span class="n">last_event</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">last_event</span><span class="p">[</span><span class="s1">&#39;event_time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="position-event-tracking">Position Event Tracking</h3>
<p>Position events track actual executed position changes with execution details. This is the realized position history.</p>
<p><span class="funcname"><strong>insert_position_event</strong>(event_time, strategy_id, broker_id, exec_id, order_id, symbol, position, avg_price, trade_quantity, trade_price, event_type, group_label=None, metadata=None)</span>
Insert a canonical position event snapshot.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event_time</code></td>
<td><code>str</code></td>
<td>Event timestamp</td>
</tr>
<tr>
<td><code>strategy_id</code></td>
<td><code>int</code></td>
<td>Strategy ID</td>
</tr>
<tr>
<td><code>broker_id</code></td>
<td><code>int</code></td>
<td>Broker ID</td>
</tr>
<tr>
<td><code>exec_id</code></td>
<td><code>str</code></td>
<td>Links to execution.exec_id (unique)</td>
</tr>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Order ID</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Trading symbol</td>
</tr>
<tr>
<td><code>position</code></td>
<td><code>float</code></td>
<td>New position size after event</td>
</tr>
<tr>
<td><code>avg_price</code></td>
<td><code>float</code></td>
<td>Cost basis after event</td>
</tr>
<tr>
<td><code>trade_quantity</code></td>
<td><code>float</code></td>
<td>Signed qty: +buy, -sell</td>
</tr>
<tr>
<td><code>trade_price</code></td>
<td><code>float</code></td>
<td>Execution price</td>
</tr>
<tr>
<td><code>event_type</code></td>
<td><code>str</code></td>
<td>OPEN, CLOSE, OPEN/CLOSE, FLIP, PARTIAL_CLOSE, etc.</td>
</tr>
<tr>
<td><code>group_label</code></td>
<td><code>str</code></td>
<td>Optional grouping label</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>dict</code></td>
<td>Additional event data (stored as JSON)</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">insert_position_event</span><span class="p">(</span>
    <span class="n">event_time</span><span class="o">=</span><span class="s2">&quot;2025-01-17 14:30:45&quot;</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">,</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">avg_price</span><span class="o">=</span><span class="mf">150.25</span><span class="p">,</span>
    <span class="n">trade_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">trade_price</span><span class="o">=</span><span class="mf">150.25</span><span class="p">,</span>
    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
    <span class="n">group_label</span><span class="o">=</span><span class="s2">&quot;tech_basket&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_last_position_event</strong>(strategy_id, symbol)</span>
Get the most recent position event for a strategy-symbol pair.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategy_id</code></td>
<td><code>int</code></td>
<td>Strategy ID</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Trading symbol</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> Dictionary with event details, or None</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">last_position</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_last_position_event</span><span class="p">(</span><span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">last_position</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current position: </span><span class="si">{</span><span class="n">last_position</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">last_position</span><span class="p">[</span><span class="s1">&#39;avg_price&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="external-position-management">External Position Management</h3>
<p>External positions track actual positions reported by your broker. This table stores the raw position data from the broker API for reconciliation.</p>
<p><span class="funcname"><strong>insert_position_external</strong>(account, contract_id, position, avg_cost, info_1="", info_2="", info_3="", info_4="", info_5="")</span>
Records a position update from the broker. Typically called when receiving position callbacks from broker API.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account</code></td>
<td><code>str</code></td>
<td>Broker account number</td>
</tr>
<tr>
<td><code>contract_id</code></td>
<td><code>int</code></td>
<td>Broker contract ID</td>
</tr>
<tr>
<td><code>position</code></td>
<td><code>float</code></td>
<td>Current position size</td>
</tr>
<tr>
<td><code>avg_cost</code></td>
<td><code>float</code></td>
<td>Average cost basis</td>
</tr>
<tr>
<td><code>info_1</code> to <code>info_5</code></td>
<td><code>str</code></td>
<td>Custom metadata fields</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># When receiving broker position callback</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_position_external</span><span class="p">(</span>
    <span class="n">account</span><span class="o">=</span><span class="s2">&quot;U1234567&quot;</span><span class="p">,</span>
    <span class="n">contract_id</span><span class="o">=</span><span class="mi">12345</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">avg_cost</span><span class="o">=</span><span class="mf">150.25</span><span class="p">,</span>
    <span class="n">info_1</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">info_2</span><span class="o">=</span><span class="s2">&quot;STOCK&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_positions_external</strong>(account=None)</span>
Retrieves external positions, optionally filtered by account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account</code></td>
<td><code>str</code></td>
<td>Filter by specific account (optional)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with external positions</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Get all external positions</span>
<span class="n">all_ext_positions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_positions_external</span><span class="p">()</span>

<span class="c1"># Get positions for specific account</span>
<span class="n">account_positions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_positions_external</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="s2">&quot;U1234567&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="execution-tracking">Execution Tracking</h3>
<p><span class="funcname"><strong>insert_execution</strong>(exec_id, order_id, strategy_id, broker_id, symbol, instrument_type, contract_id, side, quantity, price, exec_time, exchange=None, liquidity_flag=None, order_type=None, cum_qty=None, avg_price=None, is_liquidation=None, external_order_id=None, external_exec_id=None, metadata=None)</span>
Records a trade execution with full details. This should be called from execution callbacks.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exec_id</code></td>
<td><code>str</code></td>
<td>Unique execution ID</td>
</tr>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Quantstrip order ID (foreign key)</td>
</tr>
<tr>
<td><code>strategy_id</code></td>
<td><code>int</code></td>
<td>Strategy ID</td>
</tr>
<tr>
<td><code>broker_id</code></td>
<td><code>int</code></td>
<td>Broker ID</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Trading symbol (e.g., SPY, AAPL, BTCUSDT)</td>
</tr>
<tr>
<td><code>instrument_type</code></td>
<td><code>str</code></td>
<td>STOCK, CRYPTO, FUTURE, OPTION</td>
</tr>
<tr>
<td><code>contract_id</code></td>
<td><code>str</code></td>
<td>IB conId, Binance alt ID</td>
</tr>
<tr>
<td><code>side</code></td>
<td><code>str</code></td>
<td>BUY or SELL</td>
</tr>
<tr>
<td><code>quantity</code></td>
<td><code>float</code></td>
<td>Execution quantity (always positive)</td>
</tr>
<tr>
<td><code>price</code></td>
<td><code>float</code></td>
<td>Execution price</td>
</tr>
<tr>
<td><code>exec_time</code></td>
<td><code>str</code></td>
<td>Execution timestamp</td>
</tr>
<tr>
<td><code>exchange</code></td>
<td><code>str</code></td>
<td>NYSE, ARCA, BINANCE, etc.</td>
</tr>
<tr>
<td><code>liquidity_flag</code></td>
<td><code>str</code></td>
<td>MAKER, TAKER, etc.</td>
</tr>
<tr>
<td><code>order_type</code></td>
<td><code>str</code></td>
<td>MKT, LMT, IOC, FOK</td>
</tr>
<tr>
<td><code>cum_qty</code></td>
<td><code>float</code></td>
<td>Cumulative filled quantity</td>
</tr>
<tr>
<td><code>avg_price</code></td>
<td><code>float</code></td>
<td>Broker-reported average price</td>
</tr>
<tr>
<td><code>is_liquidation</code></td>
<td><code>int</code></td>
<td>Forced liquidation flag (0 or 1)</td>
</tr>
<tr>
<td><code>external_order_id</code></td>
<td><code>str</code></td>
<td>Broker's order ID</td>
</tr>
<tr>
<td><code>external_exec_id</code></td>
<td><code>str</code></td>
<td>Broker's execution ID</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>dict</code></td>
<td>Additional data (stored as JSON)</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># When receiving broker execDetails callback</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_execution</span><span class="p">(</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">,</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">instrument_type</span><span class="o">=</span><span class="s2">&quot;STOCK&quot;</span><span class="p">,</span>
    <span class="n">contract_id</span><span class="o">=</span><span class="s2">&quot;265598&quot;</span><span class="p">,</span>
    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">price</span><span class="o">=</span><span class="mf">150.25</span><span class="p">,</span>
    <span class="n">exec_time</span><span class="o">=</span><span class="s2">&quot;2025-01-17 14:30:45&quot;</span><span class="p">,</span>
    <span class="n">exchange</span><span class="o">=</span><span class="s2">&quot;SMART&quot;</span><span class="p">,</span>
    <span class="n">liquidity_flag</span><span class="o">=</span><span class="s2">&quot;TAKER&quot;</span><span class="p">,</span>
    <span class="n">order_type</span><span class="o">=</span><span class="s2">&quot;LMT&quot;</span><span class="p">,</span>
    <span class="n">cum_qty</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">avg_price</span><span class="o">=</span><span class="mf">150.25</span><span class="p">,</span>
    <span class="n">is_liquidation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">external_order_id</span><span class="o">=</span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
    <span class="n">external_exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_executions</strong>(order_id=None, exec_id=None)</span>
Retrieves execution records with optional filtering.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Filter by order ID (optional)</td>
</tr>
<tr>
<td><code>exec_id</code></td>
<td><code>str</code></td>
<td>Filter by execution ID (optional)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with execution details</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Get all executions for an order</span>
<span class="n">order_execs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_executions</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="mi">163847291</span><span class="p">)</span>

<span class="c1"># Get specific execution</span>
<span class="n">specific_exec</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_executions</span><span class="p">(</span><span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">)</span>

<span class="c1"># Get all executions</span>
<span class="n">all_execs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_executions</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<h3 id="commission-tracking">Commission Tracking</h3>
<p><span class="funcname"><strong>insert_commission</strong>(exec_id, amount, currency, fee_type, realized_pnl=None, metadata=None)</span>
Records commission and fees for a specific execution. Called when receiving broker commission reports.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exec_id</code></td>
<td><code>str</code></td>
<td>Links to execution record</td>
</tr>
<tr>
<td><code>amount</code></td>
<td><code>float</code></td>
<td>Commission/fee amount</td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code>str</code></td>
<td>Commission currency (e.g., "USD")</td>
</tr>
<tr>
<td><code>fee_type</code></td>
<td><code>str</code></td>
<td>Commission type identifier</td>
</tr>
<tr>
<td><code>realized_pnl</code></td>
<td><code>float</code></td>
<td>Realized profit/loss</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>dict</code></td>
<td>Additional data (stored as JSON)</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">insert_commission</span><span class="p">(</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">,</span>
    <span class="n">amount</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span>
    <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span>
    <span class="n">fee_type</span><span class="o">=</span><span class="s2">&quot;commission&quot;</span><span class="p">,</span>
    <span class="n">realized_pnl</span><span class="o">=</span><span class="mf">523.50</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;tiered&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="broker-management">Broker Management</h3>
<p><span class="funcname"><strong>insert_broker</strong>(name, full_name)</span>
Adds a new broker to the system.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>str</code></td>
<td>Short broker identifier (e.g., "IBKR")</td>
</tr>
<tr>
<td><code>full_name</code></td>
<td><code>str</code></td>
<td>Full broker name</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">insert_broker</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;IBKR&quot;</span><span class="p">,</span>
    <span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;Interactive Brokers&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>update_broker</strong>(broker_id, name, full_name)</span>
Updates an existing broker's details.</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">update_broker</span><span class="p">(</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;IBKR&quot;</span><span class="p">,</span>
    <span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;Interactive Brokers LLC&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>delete_broker</strong>(broker_id)</span>
Removes a broker from the system.</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">delete_broker</span><span class="p">(</span><span class="n">broker_id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_brokers</strong>()</span>
Returns all registered brokers.</p>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with broker_id, name, and full_name</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">brokers</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_brokers</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">brokers</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_broker_id</strong>(name)</span>
Looks up a broker's ID by name.</p>
<p><strong>Returns:</strong> <code>int</code> or <code>None</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">broker_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_broker_id</span><span class="p">(</span><span class="s2">&quot;IBKR&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="strategy-management">Strategy Management</h3>
<p><span class="funcname"><strong>get_strategies</strong>()</span>
Returns all registered trading strategies.</p>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with strategy_id, name, and description</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">strategies</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_strategies</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">strategies</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_strategy_id</strong>(name)</span>
Looks up a strategy's ID by name.</p>
<p><strong>Returns:</strong> <code>int</code> or <code>None</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">strategy_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_strategy_id</span><span class="p">(</span><span class="s2">&quot;momentum_v2&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="reporting-system">Reporting System</h3>
<p>The reporting system provides a hierarchical structure for generating trade reports: Report  Sections  Items.</p>
<p><span class="funcname"><strong>insert_report</strong>(name, date, status, report_type, recipients)</span>
Creates a new report container. This is the top-level object for organizing report content.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>str</code></td>
<td>Report title</td>
</tr>
<tr>
<td><code>date</code></td>
<td><code>str</code></td>
<td>Report date</td>
</tr>
<tr>
<td><code>status</code></td>
<td><code>str</code></td>
<td>Status (e.g., "draft", "final", "sent")</td>
</tr>
<tr>
<td><code>report_type</code></td>
<td><code>str</code></td>
<td>Report type (e.g., "daily", "monthly")</td>
</tr>
<tr>
<td><code>recipients</code></td>
<td><code>str</code></td>
<td>Comma-separated recipient list</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>int</code> - report_id</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">report_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_report</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Daily Trading Report - Jan 17&quot;</span><span class="p">,</span>
    <span class="n">date</span><span class="o">=</span><span class="s2">&quot;2025-01-17&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;draft&quot;</span><span class="p">,</span>
    <span class="n">report_type</span><span class="o">=</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="n">recipients</span><span class="o">=</span><span class="s2">&quot;trader@example.com,manager@example.com&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>update_report</strong>(report_id, name=None, date=None, status=None, report_type=None, recipients=None)</span>
Updates report fields. Only provided parameters are updated.</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Mark report as final</span>
<span class="n">db</span><span class="o">.</span><span class="n">update_report</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>

<span class="c1"># Update multiple fields</span>
<span class="n">db</span><span class="o">.</span><span class="n">update_report</span><span class="p">(</span>
    <span class="n">report_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;sent&quot;</span><span class="p">,</span>
    <span class="n">recipients</span><span class="o">=</span><span class="s2">&quot;trader@example.com,compliance@example.com&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_reports</strong>(report_id=None)</span>
Retrieves reports, optionally filtered by ID. Results are ordered by date (newest first).</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Get all reports</span>
<span class="n">all_reports</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_reports</span><span class="p">()</span>

<span class="c1"># Get specific report</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_reports</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>insert_report_section</strong>(report_id, name, section_type)</span>
Adds a section to a report. Sections organize content by category (e.g., "Summary", "Risk Analysis", "Trade List").</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>report_id</code></td>
<td><code>int</code></td>
<td>Parent report ID</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>str</code></td>
<td>Section title</td>
</tr>
<tr>
<td><code>section_type</code></td>
<td><code>str</code></td>
<td>Section type identifier</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>int</code> - section_id</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">summary_section</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_report_section</span><span class="p">(</span>
    <span class="n">report_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Executive Summary&quot;</span><span class="p">,</span>
    <span class="n">section_type</span><span class="o">=</span><span class="s2">&quot;summary&quot;</span>
<span class="p">)</span>

<span class="n">trades_section</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_report_section</span><span class="p">(</span>
    <span class="n">report_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Today&#39;s Trades&quot;</span><span class="p">,</span>
    <span class="n">section_type</span><span class="o">=</span><span class="s2">&quot;trade_list&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_report_sections</strong>(report_id)</span>
Retrieves all sections for a report, ordered by section_id.</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">sections</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_report_sections</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Section: </span><span class="si">{</span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>insert_report_item</strong>(section_id, text)</span>
Adds content to a report section. Items contain the actual text/data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>section_id</code></td>
<td><code>int</code></td>
<td>Parent section ID</td>
</tr>
<tr>
<td><code>text</code></td>
<td><code>str</code></td>
<td>Content text (can be markdown, JSON, etc.)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>int</code> - item_id</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">insert_report_item</span><span class="p">(</span>
    <span class="n">section_id</span><span class="o">=</span><span class="n">summary_section</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Traded 5 symbols today with 100</span><span class="si">% f</span><span class="s2">ill rate.&quot;</span>
<span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">insert_report_item</span><span class="p">(</span>
    <span class="n">section_id</span><span class="o">=</span><span class="n">trades_section</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;AAPL: BUY 100 @ $150.25&quot;</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_report_items</strong>(section_id)</span>
Retrieves all items for a section, ordered by item_id.</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">items</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_report_items</span><span class="p">(</span><span class="n">section_id</span><span class="o">=</span><span class="n">summary_section</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
</code></pre></div></p>
<hr />
<h3 id="email-account-management">Email Account Management</h3>
<p>The email account system manages SMTP configurations for sending reports and notifications.</p>
<p><span class="funcname"><strong>get_all_email_accounts</strong>()</span>
Get all configured email accounts.</p>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code> with all email account details</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">accounts</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_email_accounts</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;from_address&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_email_account_by_id</strong>(email_account_id)</span>
Get a specific email account by ID.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>email_account_id</code></td>
<td><code>int</code></td>
<td>Email account ID</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> Dictionary with account details, or None</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">account</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_email_account_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="n">account</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SMTP: </span><span class="si">{</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;smtp_server&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;smtp_port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_email_account_by_name</strong>(name)</span>
Get a specific email account by name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>str</code></td>
<td>Email account name</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> Dictionary with account details, or None</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">account</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_email_account_by_name</span><span class="p">(</span><span class="s2">&quot;Gmail Trading&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_default_email_account</strong>()</span>
Get the default email account.</p>
<p><strong>Returns:</strong> Dictionary with account details, or None</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">default_account</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_default_email_account</span><span class="p">()</span>
<span class="k">if</span> <span class="n">default_account</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default: </span><span class="si">{</span><span class="n">default_account</span><span class="p">[</span><span class="s1">&#39;from_address&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="complete-report-example">Complete Report Example</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a daily report</span>
<span class="n">report_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_report</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Daily Report - Jan 17, 2025&quot;</span><span class="p">,</span>
    <span class="n">date</span><span class="o">=</span><span class="s2">&quot;2025-01-17&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;draft&quot;</span><span class="p">,</span>
    <span class="n">report_type</span><span class="o">=</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="n">recipients</span><span class="o">=</span><span class="s2">&quot;team@example.com&quot;</span>
<span class="p">)</span>

<span class="c1"># Add summary section</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_report_section</span><span class="p">(</span>
    <span class="n">report_id</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Executive Summary&quot;</span><span class="p">,</span>
    <span class="n">section_type</span><span class="o">=</span><span class="s2">&quot;summary&quot;</span>
<span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">insert_report_item</span><span class="p">(</span>
    <span class="n">section_id</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Total P&amp;L: $1,234.56&quot;</span>
<span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">insert_report_item</span><span class="p">(</span>
    <span class="n">section_id</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Win rate: 65%&quot;</span>
<span class="p">)</span>

<span class="c1"># Add trades section</span>
<span class="n">trades</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">insert_report_section</span><span class="p">(</span>
    <span class="n">report_id</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Executed Trades&quot;</span><span class="p">,</span>
    <span class="n">section_type</span><span class="o">=</span><span class="s2">&quot;trades&quot;</span>
<span class="p">)</span>

<span class="c1"># Get executions for the day</span>
<span class="n">executions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_executions</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">exec</span> <span class="ow">in</span> <span class="n">executions</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">db</span><span class="o">.</span><span class="n">insert_report_item</span><span class="p">(</span>
        <span class="n">section_id</span><span class="o">=</span><span class="n">trades</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exec</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">exec</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">exec</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> @ $</span><span class="si">{</span><span class="n">exec</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="c1"># Finalize report</span>
<span class="n">db</span><span class="o">.</span><span class="n">update_report</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="complete-order-workflow-example">Complete Order Workflow Example</h3>
<p>Here's a complete example showing the typical order lifecycle with all database operations:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">quantstrip</span><span class="w"> </span><span class="kn">import</span> <span class="n">db_handler</span> <span class="k">as</span> <span class="n">db</span>

<span class="c1"># 1. Generate order ID</span>
<span class="n">order_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">next_order_id</span><span class="p">()</span>  <span class="c1"># e.g., 163847291</span>

<span class="c1"># 2. Create order record</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">account</span><span class="o">=</span><span class="s2">&quot;U1234567&quot;</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
    <span class="n">order_type</span><span class="o">=</span><span class="s2">&quot;LMT&quot;</span><span class="p">,</span>
    <span class="n">total_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">limit_price</span><span class="o">=</span><span class="mf">150.50</span><span class="p">,</span>
    <span class="n">instrument_type</span><span class="o">=</span><span class="s2">&quot;STOCK&quot;</span><span class="p">,</span>
    <span class="n">client_reference</span><span class="o">=</span><span class="s2">&quot;tech_basket_entry&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;signal_type&quot;</span><span class="p">:</span> <span class="s2">&quot;momentum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;entry_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-01-17&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># 3. Create strategy event (planned position change)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_strategy_event</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
    <span class="n">group_label</span><span class="o">=</span><span class="s2">&quot;tech_basket&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;signal&quot;</span><span class="p">:</span> <span class="s2">&quot;momentum_crossover&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># 4. After placing order with broker, update external_order_id</span>
<span class="n">db</span><span class="o">.</span><span class="n">update_order_external_id</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span> <span class="n">external_order_id</span><span class="o">=</span><span class="s2">&quot;1234567890&quot;</span><span class="p">)</span>

<span class="c1"># 5. When orderStatus callback is received (order submitted)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order_status</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;SUBMITTED&quot;</span><span class="p">,</span>
    <span class="n">filled_quantity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">remaining_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">external_order_id</span><span class="o">=</span><span class="s2">&quot;1234567890&quot;</span>
<span class="p">)</span>

<span class="c1"># 6. When order partially fills (orderStatus callback)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order_status</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;PARTIALLY_FILLED&quot;</span><span class="p">,</span>
    <span class="n">filled_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">remaining_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">avg_fill_price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">last_fill_price</span><span class="o">=</span><span class="mf">150.48</span>
<span class="p">)</span>

<span class="c1"># 7. When execDetails callback is received (first fill)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_execution</span><span class="p">(</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">,</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">instrument_type</span><span class="o">=</span><span class="s2">&quot;STOCK&quot;</span><span class="p">,</span>
    <span class="n">contract_id</span><span class="o">=</span><span class="s2">&quot;265598&quot;</span><span class="p">,</span>
    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">exec_time</span><span class="o">=</span><span class="s2">&quot;2025-01-17 14:30:45&quot;</span><span class="p">,</span>
    <span class="n">exchange</span><span class="o">=</span><span class="s2">&quot;SMART&quot;</span><span class="p">,</span>
    <span class="n">liquidity_flag</span><span class="o">=</span><span class="s2">&quot;TAKER&quot;</span><span class="p">,</span>
    <span class="n">order_type</span><span class="o">=</span><span class="s2">&quot;LMT&quot;</span><span class="p">,</span>
    <span class="n">cum_qty</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">avg_price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">external_order_id</span><span class="o">=</span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
    <span class="n">external_exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span>
<span class="p">)</span>

<span class="c1"># 8. When commissionReport callback is received</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_commission</span><span class="p">(</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">,</span>
    <span class="n">amount</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span>
    <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span>
    <span class="n">fee_type</span><span class="o">=</span><span class="s2">&quot;commission&quot;</span><span class="p">,</span>
    <span class="n">realized_pnl</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># 9. Update position event (actual position change)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_position_event</span><span class="p">(</span>
    <span class="n">event_time</span><span class="o">=</span><span class="s2">&quot;2025-01-17 14:30:45&quot;</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.01&quot;</span><span class="p">,</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">avg_price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">trade_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">trade_price</span><span class="o">=</span><span class="mf">150.48</span><span class="p">,</span>
    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
    <span class="n">group_label</span><span class="o">=</span><span class="s2">&quot;tech_basket&quot;</span>
<span class="p">)</span>

<span class="c1"># 10. When order completely fills (orderStatus callback)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_order_status</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;FILLED&quot;</span><span class="p">,</span>
    <span class="n">filled_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">remaining_quantity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">avg_fill_price</span><span class="o">=</span><span class="mf">150.485</span><span class="p">,</span>
    <span class="n">last_fill_price</span><span class="o">=</span><span class="mf">150.49</span>
<span class="p">)</span>

<span class="c1"># 11. Record second execution</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_execution</span><span class="p">(</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.02&quot;</span><span class="p">,</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">instrument_type</span><span class="o">=</span><span class="s2">&quot;STOCK&quot;</span><span class="p">,</span>
    <span class="n">contract_id</span><span class="o">=</span><span class="s2">&quot;265598&quot;</span><span class="p">,</span>
    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">price</span><span class="o">=</span><span class="mf">150.49</span><span class="p">,</span>
    <span class="n">exec_time</span><span class="o">=</span><span class="s2">&quot;2025-01-17 14:31:12&quot;</span><span class="p">,</span>
    <span class="n">exchange</span><span class="o">=</span><span class="s2">&quot;SMART&quot;</span><span class="p">,</span>
    <span class="n">liquidity_flag</span><span class="o">=</span><span class="s2">&quot;TAKER&quot;</span><span class="p">,</span>
    <span class="n">order_type</span><span class="o">=</span><span class="s2">&quot;LMT&quot;</span><span class="p">,</span>
    <span class="n">cum_qty</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">avg_price</span><span class="o">=</span><span class="mf">150.485</span><span class="p">,</span>
    <span class="n">external_order_id</span><span class="o">=</span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
    <span class="n">external_exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.02&quot;</span>
<span class="p">)</span>

<span class="c1"># 12. Update final position event</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert_position_event</span><span class="p">(</span>
    <span class="n">event_time</span><span class="o">=</span><span class="s2">&quot;2025-01-17 14:31:12&quot;</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">exec_id</span><span class="o">=</span><span class="s2">&quot;0001f4e8.65a1b2c3.01.02&quot;</span><span class="p">,</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">avg_price</span><span class="o">=</span><span class="mf">150.485</span><span class="p">,</span>
    <span class="n">trade_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">trade_price</span><span class="o">=</span><span class="mf">150.49</span><span class="p">,</span>
    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
    <span class="n">group_label</span><span class="o">=</span><span class="s2">&quot;tech_basket&quot;</span>
<span class="p">)</span>

<span class="c1"># 13. Mark strategy event as executed</span>
<span class="c1"># (Note: This would require an update method for strategy_event,</span>
<span class="c1">#  which is not currently in the code but would be useful)</span>

<span class="c1"># 14. Query current position</span>
<span class="n">last_position</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_last_position_event</span><span class="p">(</span><span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current position: </span><span class="si">{</span><span class="n">last_position</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">last_position</span><span class="p">[</span><span class="s1">&#39;avg_price&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="position-reconciliation-example">Position Reconciliation Example</h3>
<p>Compare internal positions (strategy events and position events) with external positions from broker:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get internal position from position_event table</span>
<span class="n">internal_position</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_last_position_event</span><span class="p">(</span><span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>

<span class="c1"># Get external position from broker</span>
<span class="n">external_positions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_positions_external</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="s2">&quot;U1234567&quot;</span><span class="p">)</span>
<span class="n">external_aapl</span> <span class="o">=</span> <span class="n">external_positions</span><span class="p">[</span><span class="n">external_positions</span><span class="p">[</span><span class="s1">&#39;info_1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">]</span>

<span class="c1"># Compare</span>
<span class="k">if</span> <span class="n">internal_position</span><span class="p">:</span>
    <span class="n">internal_qty</span> <span class="o">=</span> <span class="n">internal_position</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
    <span class="n">internal_avg</span> <span class="o">=</span> <span class="n">internal_position</span><span class="p">[</span><span class="s1">&#39;avg_price&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">external_aapl</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">external_qty</span> <span class="o">=</span> <span class="n">external_aapl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
        <span class="n">external_avg</span> <span class="o">=</span> <span class="n">external_aapl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;avg_cost&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">internal_qty</span> <span class="o">-</span> <span class="n">external_qty</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Position mismatch for AAPL!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Internal: </span><span class="si">{</span><span class="n">internal_qty</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">internal_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   External: </span><span class="si">{</span><span class="n">external_qty</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">external_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Positions reconciled: </span><span class="si">{</span><span class="n">internal_qty</span><span class="si">}</span><span class="s2"> shares&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="database-tables-reference">Database Tables Reference</h2>
<h3 id="core-trading-tables">Core Trading Tables</h3>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>orders</code></td>
<td>Canonical order records with Quantstrip order_id</td>
</tr>
<tr>
<td><code>order_status</code></td>
<td>Complete history of order status changes (append-only)</td>
</tr>
<tr>
<td><code>execution</code></td>
<td>Individual trade executions with full details</td>
</tr>
<tr>
<td><code>commission</code></td>
<td>Commission and fee records linked to executions</td>
</tr>
<tr>
<td><code>position_event</code></td>
<td>Actual realized position changes (linked to executions)</td>
</tr>
<tr>
<td><code>strategy_event</code></td>
<td>Planned position changes (intent before execution)</td>
</tr>
<tr>
<td><code>position_external</code></td>
<td>Raw broker-reported positions for reconciliation</td>
</tr>
</tbody>
</table>
<h3 id="reference-tables">Reference Tables</h3>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>broker</code></td>
<td>Registered brokers (IBKR, Binance, etc.)</td>
</tr>
<tr>
<td><code>strategy</code></td>
<td>Trading strategies</td>
</tr>
<tr>
<td><code>order_id_state</code></td>
<td>Order ID generation state (singleton record)</td>
</tr>
<tr>
<td><code>mtm_price</code></td>
<td>Mark-to-market prices for valuation</td>
</tr>
</tbody>
</table>
<h3 id="reporting-tables">Reporting Tables</h3>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>report</code></td>
<td>Report containers</td>
</tr>
<tr>
<td><code>report_section</code></td>
<td>Report sections within reports</td>
</tr>
<tr>
<td><code>report_item</code></td>
<td>Individual content items within sections</td>
</tr>
<tr>
<td><code>email_account</code></td>
<td>SMTP configurations for sending reports</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="key-design-patterns">Key Design Patterns</h2>
<h3 id="event-based-position-tracking">Event-Based Position Tracking</h3>
<p>The system uses two complementary position tracking mechanisms:</p>
<ol>
<li><strong>Strategy Events</strong> (<code>strategy_event</code> table)</li>
<li>Records intended position changes</li>
<li>Created when strategy signals a trade</li>
<li>Status: PENDING  EXECUTED/FAILED</li>
<li>
<p>Used for planning and verification</p>
</li>
<li>
<p><strong>Position Events</strong> (<code>position_event</code> table)</p>
</li>
<li>Records actual position changes</li>
<li>Created when executions occur</li>
<li>Linked to specific executions via <code>exec_id</code></li>
<li>Provides complete audit trail of realized positions</li>
</ol>
<p>This dual-tracking allows you to:
- Compare intended vs. actual positions
- Track execution slippage
- Identify failed orders
- Maintain complete position history</p>
<h3 id="append-only-order-status">Append-Only Order Status</h3>
<p>The <code>order_status</code> table is append-only - every status change creates a new row rather than updating existing rows. This provides:</p>
<ul>
<li>Complete audit trail of order lifecycle</li>
<li>Ability to analyze timing of status changes</li>
<li>No data loss from updates</li>
<li>Easy debugging of order issues</li>
</ul>
<p>Use <code>get_current_order_status()</code> to get the latest status, or <code>get_order_status()</code> to see complete history.</p>
<h3 id="json-metadata-storage">JSON Metadata Storage</h3>
<p>Many tables include a <code>metadata</code> field that stores arbitrary JSON data. This allows:</p>
<ul>
<li>Broker-specific fields without schema changes</li>
<li>Custom strategy parameters</li>
<li>Flexible data storage for evolving needs</li>
<li>Easy addition of new fields</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;algo_name&quot;</span><span class="p">:</span> <span class="s2">&quot;VWAP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;urgency&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;broker_specific_field&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
<span class="p">}</span>

<span class="n">db</span><span class="o">.</span><span class="n">insert_order</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="c1"># ... other fields ...</span>
    <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span>
<span class="p">)</span>
</code></pre></div></p>
<hr />
<h2 id="thread-safety-and-connection-pooling">Thread Safety and Connection Pooling</h2>
<p>The <code>DBHandler</code> is a thread-safe singleton with connection pooling:</p>
<ul>
<li><strong>Singleton Pattern</strong>: Only one instance per application</li>
<li><strong>Connection Pool</strong>: Pre-created connections for efficiency (pool size: 10)</li>
<li><strong>Context Managers</strong>: Automatic connection lifecycle management</li>
<li><strong>Lock Protection</strong>: Thread-safe order ID generation</li>
<li><strong>WAL Mode</strong>: Write-Ahead Logging for better concurrency</li>
</ul>
<p><strong>Best Practices:</strong>
- Always use <code>get_connection()</code> context manager for custom queries
- Use the built-in methods for common operations
- Don't hold connections longer than necessary
- Connection pool automatically handles overflow with temporary connections</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="quantstrip.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: quantstrip">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                quantstrip
              </div>
            </div>
          </a>
        
        
          
          <a href="email.html" class="md-footer__link md-footer__link--next" aria-label="Next: email_manager">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                email_manager
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>