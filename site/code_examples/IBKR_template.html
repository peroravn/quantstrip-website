
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="templates_general.html">
      
      
        <link rel="next" href="../API/quantstrip.html">
      
      
      <link rel="icon" href="../assets/Q_logo.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Interactive Brokers - Documentation 0.94</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../styles/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="github" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#interactive-brokers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Documentation 0.94" class="md-header__button md-logo" aria-label="Documentation 0.94" data-md-component="logo">
      
  <img src="../assets/Logo_all_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation 0.94
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Interactive Brokers
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Documentation 0.94" class="md-nav__button md-logo" aria-label="Documentation 0.94" data-md-component="logo">
      
  <img src="../assets/Logo_all_white.png" alt="logo">

    </a>
    Documentation 0.94
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Basic Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Basic Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dashboard Apps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Dashboard Apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/client_monitor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client Monitor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/python_editor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Editor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/email.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/SQL_database.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SQL Database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/logging.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard_apps/settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="templates_general.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Broker Integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Broker Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Interactive Brokers
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="IBKR_template.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Interactive Brokers
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ib-api-vs-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      IB API vs REST API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronous-ib-api-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronous IB API Wrapper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ib_connect" class="md-nav__link">
    <span class="md-ellipsis">
      ib_connect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ib_connect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-management" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-data-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Market Data Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#account-portfolio-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Account &amp; Portfolio Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Order Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-reference-data-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Contract &amp; Reference Data Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Usage Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ib-objects" class="md-nav__link">
    <span class="md-ellipsis">
      IB Objects
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IB Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contract-function" class="md-nav__link">
    <span class="md-ellipsis">
      Contract Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Order Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-an-order-to-ib" class="md-nav__link">
    <span class="md-ellipsis">
      Sending an Order to IB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending an Order to IB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-class" class="md-nav__link">
    <span class="md-ellipsis">
      Client Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Default Settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Database Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-record" class="md-nav__link">
    <span class="md-ellipsis">
      Order Record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategy-event-record" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Event Record
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Database Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ib-connection" class="md-nav__link">
    <span class="md-ellipsis">
      IB Connection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#different-symbolquantity" class="md-nav__link">
    <span class="md-ellipsis">
      Different Symbol/Quantity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#different-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Different Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Continuous Operation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Important Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Strategy Templates
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Strategy Templates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="monthly_rebalancing.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monthly Rebalancing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API/quantstrip.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantstrip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API/database.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    db_handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API/email.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    email_manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API/settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API/logging.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    logging
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Back to Dashboard
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ib-api-vs-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      IB API vs REST API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronous-ib-api-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronous IB API Wrapper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ib_connect" class="md-nav__link">
    <span class="md-ellipsis">
      ib_connect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ib_connect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-management" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-data-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Market Data Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#account-portfolio-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Account &amp; Portfolio Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Order Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-reference-data-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Contract &amp; Reference Data Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Usage Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ib-objects" class="md-nav__link">
    <span class="md-ellipsis">
      IB Objects
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IB Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contract-function" class="md-nav__link">
    <span class="md-ellipsis">
      Contract Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Order Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-an-order-to-ib" class="md-nav__link">
    <span class="md-ellipsis">
      Sending an Order to IB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending an Order to IB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-class" class="md-nav__link">
    <span class="md-ellipsis">
      Client Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Default Settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Database Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-record" class="md-nav__link">
    <span class="md-ellipsis">
      Order Record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategy-event-record" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy Event Record
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Database Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ib-connection" class="md-nav__link">
    <span class="md-ellipsis">
      IB Connection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#different-symbolquantity" class="md-nav__link">
    <span class="md-ellipsis">
      Different Symbol/Quantity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#different-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Different Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Continuous Operation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Important Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="interactive-brokers">Interactive Brokers</h1>
<p>The following code examples for integrating with Interactive Brokers are included with Quantstrip. They can all be downloaded from the Script Templates section on the Quantstrip website.</p>
<ul>
<li><code>ib_connect.py</code></li>
<li><code>ib_objects.py</code></li>
<li><code>ib_send_order.py</code></li>
</ul>
<h2 id="ib-api-vs-rest-api">IB API vs REST API</h2>
<p>Interactive Brokers offers two primary APIs for algorithmic trading and account management: the <strong>TWS API</strong> (also known as the IB API) and the <strong>REST API</strong> (Client Portal Web API).</p>
<p>The TWS API is a socket-based interface that connects through either the Trader Workstation (TWS) desktop application or IB Gateway. It provides real-time streaming data, comprehensive order management, and access to historical market data. One of its key advantages is authentication persistenceâ€”users only need to log in once per week, making it more convenient for automated trading systems that run continuously.</p>
<p>The REST API (Client Portal Web API) is a modern, web-based interface that uses standard HTTP requests, making it easier to integrate with web applications and services that don't require constant connectivity. However, it requires daily authentication, as users must log in each trading day through the Client Portal gateway. This makes it less suitable for fully automated systems but more accessible for developers familiar with RESTful architecture.</p>
<p>The choice between the two depends on the use case, but for continuously running trading applications the weekly authentication requirements of the TWS API makes it the better choice.</p>
<hr />
<h2 id="synchronous-ib-api-wrapper">Synchronous IB API Wrapper</h2>
<p>The TWS API uses an asynchronous, callback-based design where requests and responses are decoupledâ€”you send a request through one method and receive the response later through a separate callback function. While this architecture is powerful for handling high-frequency, real-time data streams, it presents a steep learning curve for developers accustomed to synchronous programming patterns.</p>
<p>For intraday trading strategies operating on a 5-10 minute timeframe where millisecond precision isn't critical, many developers find it beneficial to build a synchronous wrapper around the TWS API. This wrapper can convert the asynchronous callbacks into blocking function calls that wait for and return responses directly, making the code more intuitive and easier to reason about. The wrapper effectively bridges the gap between the API's event-driven architecture and traditional procedural code, simplifying strategy development while maintaining full access to the API's capabilities. For slower-paced trading strategies, the slight overhead introduced by this abstraction is negligible and the improved code clarity is well worth the trade-off.</p>
<hr />
<h2 id="ib_connect"><code>ib_connect</code></h2>
<p>This module provides a synchronous wrapper around Interactive Brokers' asynchronous Python API (ibapi). It uses threading events and thread-safe request IDs to convert IB's callback-based architecture into blocking <code>get_*</code> methods that wait for responses and return structured data. Each method manages its own event synchronization, making the API behave like traditional synchronous function calls while maintaining full access to IB's capabilities.</p>
<hr />
<h3 id="connection-management">Connection Management</h3>
<p><span class="funcname"><strong>connect_client</strong>(host="127.0.0.1", port=7497, client_id=1)</span></p>
<p>Connect to IB Gateway or TWS. Returns <code>True</code> if connected within 5 seconds, otherwise <code>False</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td><code>str</code></td>
<td>IB Gateway/TWS hostname (default: "127.0.0.1")</td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>int</code></td>
<td>API port (7497 for paper, 7496 for live)</td>
</tr>
<tr>
<td><code>client_id</code></td>
<td><code>int</code></td>
<td>Unique client identifier</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>bool</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">IBKR.ib_connect</span><span class="w"> </span><span class="kn">import</span> <span class="n">IB</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="k">if</span> <span class="n">ib</span><span class="o">.</span><span class="n">connect_client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7497</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected successfully&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connection failed&quot;</span><span class="p">)</span>
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Automatic Client ID Assignment</p>
<p>The <code>ib_connect</code> module provides a client ID pool manager that automatically assigns an available ID to the connection unless specified as an argument. Once the connection closes, the ID is returned to the pool. This is convenient when many clients connect and disconnect at different times and eliminates the need to keep track of already connected IDs in the client code.</p>
<p><strong>NOTE:</strong> Clients collecting information from other clients, for example a centralized client keeping track of all executions, needs to connect with <code>client_id = 0</code> in order to receive callbacks originating from all other clients.</p>
</div>
<hr />
<p><span class="funcname"><strong>disconnect_client</strong>()</span></p>
<p>Disconnect from IB and clean up the socket thread.</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">ib</span><span class="o">.</span><span class="n">disconnect_client</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>is_connected</strong>()</span></p>
<p>Returns <code>True</code> if currently connected to IB.</p>
<p><strong>Returns:</strong> <code>bool</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">ib</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Still connected&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_client_id_stats</strong>()</span></p>
<p>Get statistics about client ID usage from the connection pool.</p>
<p><strong>Returns:</strong> Dictionary with <code>'available'</code>, <code>'in_use'</code>, and <code>'total'</code> counts</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">stats</span> <span class="o">=</span> <span class="n">IB</span><span class="o">.</span><span class="n">get_client_id_stats</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available IDs: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In use: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;in_use&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<div class="admonition tip">
<p class="admonition-title">Using the Context Manager for Safe Connection Handling</p>
<p>IB Gateway and TWS connections must be closed properly. To do this safely, careful exception handling is required to ensure that the connection is closed if the client job crashes. A convenient alternative to manage this is by using the context manager included in the IBKR template code.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">IBKR.ib_connect</span><span class="w"> </span><span class="kn">import</span> <span class="n">IB</span>

<span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_historical_data</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_last_price</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c1"># Connection automatically closed when exiting context</span>
</code></pre></div>
<p>This syntax instantiates the <code>IB</code> class as the object <code>ib</code> and tries to connect to IB in a single line of code. By default it connects to the paper trading environment. To connect to the production environment instead, simply provide the production port number:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">7496</span><span class="p">)</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>  <span class="c1"># Live trading port</span>
    <span class="c1"># Your trading logic here</span>
</code></pre></div>
<p>The context manager automatically:
- Assigns a client ID from the pool (or uses one you specify)
- Connects to IB Gateway/TWS
- Releases the client ID back to the pool on exit
- Handles cleanup even if exceptions occur</p>
</div>
<hr />
<h3 id="market-data-methods">Market Data Methods</h3>
<p><span class="funcname"><strong>get_historical_data</strong>(contract, endDateTime="", durationStr="1 D", barSizeSetting="1 min", whatToShow="TRADES", useRTH=1, formatDate=1, keepUpToDate=False, chartOptions=None, timeout=10.0)</span></p>
<p>Request historical bars. Returns pandas DataFrame with columns: <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>, indexed by datetime. Returns empty DataFrame on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>endDateTime</code></td>
<td><code>str</code></td>
<td>End date/time (empty string = now)</td>
</tr>
<tr>
<td><code>durationStr</code></td>
<td><code>str</code></td>
<td>Duration (e.g., "1 D", "2 W", "1 M")</td>
</tr>
<tr>
<td><code>barSizeSetting</code></td>
<td><code>str</code></td>
<td>Bar size (e.g., "1 min", "5 mins", "1 hour")</td>
</tr>
<tr>
<td><code>whatToShow</code></td>
<td><code>str</code></td>
<td>Data type ("TRADES", "MIDPOINT", "BID", "ASK")</td>
</tr>
<tr>
<td><code>useRTH</code></td>
<td><code>int</code></td>
<td>1 = regular trading hours only, 0 = all hours</td>
</tr>
<tr>
<td><code>formatDate</code></td>
<td><code>int</code></td>
<td>1 = yyyyMMdd HH<img alt="ðŸ‡²ðŸ‡²" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f2-1f1f2.svg" title=":mm:" />ss, 2 = Unix timestamp</td>
</tr>
<tr>
<td><code>keepUpToDate</code></td>
<td><code>bool</code></td>
<td>Keep subscription active for updates</td>
</tr>
<tr>
<td><code>chartOptions</code></td>
<td><code>List</code></td>
<td>Additional chart options</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ibapi.contract</span><span class="w"> </span><span class="kn">import</span> <span class="n">Contract</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">()</span>
<span class="n">contract</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;AAPL&quot;</span>
<span class="n">contract</span><span class="o">.</span><span class="n">secType</span> <span class="o">=</span> <span class="s2">&quot;STK&quot;</span>
<span class="n">contract</span><span class="o">.</span><span class="n">exchange</span> <span class="o">=</span> <span class="s2">&quot;SMART&quot;</span>
<span class="n">contract</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span>

<span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_historical_data</span><span class="p">(</span>
        <span class="n">contract</span><span class="p">,</span>
        <span class="n">durationStr</span><span class="o">=</span><span class="s2">&quot;5 D&quot;</span><span class="p">,</span>
        <span class="n">barSizeSetting</span><span class="o">=</span><span class="s2">&quot;1 hour&quot;</span><span class="p">,</span>
        <span class="n">whatToShow</span><span class="o">=</span><span class="s2">&quot;TRADES&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_last_price</strong>(contract, timeout=5.0)</span></p>
<p>Request market snapshot and return the most recent trade price as float. Returns <code>None</code> if unavailable.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Optional[float]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_last_price</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">price</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current price: $</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Price not available&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_market_snapshot</strong>(contract, timeout=5.0)</span></p>
<p>Request market snapshot. Returns dict with keys: <code>last</code>, <code>bid</code>, <code>ask</code>, <code>last_size</code>, <code>last_tick</code>. Returns empty dict on timeout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Dict[str, Any]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">snapshot</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_market_snapshot</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last: </span><span class="si">{</span><span class="n">snapshot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bid: </span><span class="si">{</span><span class="n">snapshot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bid&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="n">snapshot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ask&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last Size: </span><span class="si">{</span><span class="n">snapshot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_realtime_bars</strong>(contract, whatToShow="TRADES", useRTH=0, timeout=5.0)</span></p>
<p>Request 5-second realtime bars. Returns DataFrame containing the first bar received with columns: <code>time</code>, <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>, <code>wap</code>, <code>count</code>. Returns empty DataFrame on timeout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>whatToShow</code></td>
<td><code>str</code></td>
<td>Data type ("TRADES", "MIDPOINT", "BID", "ASK")</td>
</tr>
<tr>
<td><code>useRTH</code></td>
<td><code>int</code></td>
<td>1 = regular trading hours only, 0 = all hours</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_realtime_bars</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">whatToShow</span><span class="o">=</span><span class="s2">&quot;TRADES&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">bars</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latest bar: </span><span class="si">{</span><span class="n">bars</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_historical_ticks</strong>(contract, startDateTime=None, endDateTime=None, numberOfTicks=1000, whatToShow="TRADES", useRth=1, timeout=10.0)</span></p>
<p>Request historical tick data. Returns list of tick dicts. Returns empty list on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>startDateTime</code></td>
<td><code>str</code></td>
<td>Start date/time</td>
</tr>
<tr>
<td><code>endDateTime</code></td>
<td><code>str</code></td>
<td>End date/time</td>
</tr>
<tr>
<td><code>numberOfTicks</code></td>
<td><code>int</code></td>
<td>Maximum number of ticks to retrieve</td>
</tr>
<tr>
<td><code>whatToShow</code></td>
<td><code>str</code></td>
<td>Tick type ("TRADES", "BID_ASK", "MIDPOINT")</td>
</tr>
<tr>
<td><code>useRth</code></td>
<td><code>int</code></td>
<td>1 = regular trading hours only, 0 = all hours</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_historical_ticks</span><span class="p">(</span>
        <span class="n">contract</span><span class="p">,</span>
        <span class="n">numberOfTicks</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">whatToShow</span><span class="o">=</span><span class="s2">&quot;TRADES&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span><span class="si">}</span><span class="s2"> ticks&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="account-portfolio-methods">Account &amp; Portfolio Methods</h3>
<p><span class="funcname"><strong>get_positions</strong>(timeout=10.0)</span></p>
<p>Request current positions. Returns list of dicts with keys: <code>account</code>, <code>contract</code>, <code>position</code>, <code>avgCost</code>. Returns empty list on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="s1">&#39;contract&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contract</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> @ $</span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="s1">&#39;avgCost&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_portfolio</strong>(account="", timeout=10.0)</span></p>
<p>Subscribe briefly to account updates to obtain portfolio snapshot. Returns list of dicts with keys: <code>contract</code>, <code>position</code>, <code>marketPrice</code>, <code>marketValue</code>, <code>averageCost</code>, <code>unrealizedPNL</code>, <code>realizedPNL</code>, <code>accountName</code>. Returns empty list on timeout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account</code></td>
<td><code>str</code></td>
<td>Account identifier (empty = default)</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">portfolio</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_portfolio</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;contract&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contract</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: P&amp;L $</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;unrealizedPNL&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_account_summary</strong>(group="All", tags=None, timeout=10.0)</span></p>
<p>Request account summary values. Default tags: <code>NetLiquidation</code>, <code>TotalCashValue</code>, <code>AvailableFunds</code>, <code>BuyingPower</code>. Returns DataFrame with columns: <code>reqId</code>, <code>account</code>, <code>tag</code>, <code>value</code>, <code>currency</code>. Returns empty DataFrame on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group</code></td>
<td><code>str</code></td>
<td>Account group ("All" for all accounts)</td>
</tr>
<tr>
<td><code>tags</code></td>
<td><code>str</code></td>
<td>Comma-separated list of tags to retrieve</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>pandas.DataFrame</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_account_summary</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;currency&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="order-methods">Order Methods</h3>
<p><span class="funcname"><strong>get_next_order_id</strong>(timeout=5.0)</span></p>
<p>Request the next valid order ID from IB. This is useful when you need to place orders and want to ensure you're using a valid order ID that won't conflict.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Optional[int]</code> - Next valid order ID, or None on timeout</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">order_id</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_next_order_id</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">order_id</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Next order ID: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Use this ID when placing orders</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_executions</strong>(executionFilter=None, timeout=10.0)</span></p>
<p>Request trade executions. Returns list of dicts containing order details with structure:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="s1">&#39;reqId&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s1">&#39;contract&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;secType&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;currency&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;localSymbol&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;conId&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;primaryExchange&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">},</span>
    <span class="s1">&#39;execution&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;orderId&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;clientId&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;execId&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;acctNumber&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;shares&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;permId&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;liquidation&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;cumQty&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;avgPrice&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;orderRef&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;evRule&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;evMultiplier&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;modelCode&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;lastLiquidity&#39;</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>executionFilter</code></td>
<td><code>ExecutionFilter</code></td>
<td>Filter criteria (None = all executions)</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">executions</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_executions</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">exec</span> <span class="ow">in</span> <span class="n">executions</span><span class="p">:</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">exec</span><span class="p">[</span><span class="s1">&#39;contract&#39;</span><span class="p">]</span>
        <span class="n">execution</span> <span class="o">=</span> <span class="n">exec</span><span class="p">[</span><span class="s1">&#39;execution&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contract</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">execution</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">execution</span><span class="p">[</span><span class="s1">&#39;shares&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> @ $</span><span class="si">{</span><span class="n">execution</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_commissions</strong>(executionFilter=None, timeout=10.0)</span></p>
<p>Request commission reports. Returns list of dicts with commission structure:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="s1">&#39;execId&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;commission&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">&#39;currency&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;realizedPNL&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">&#39;yield&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">&#39;yieldRedemptionDate&#39;</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Note:</strong> This calls <code>reqExecutions()</code> which triggers both <code>execDetails</code> and <code>commissionReport</code> callbacks, but only returns the commission data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>executionFilter</code></td>
<td><code>ExecutionFilter</code></td>
<td>Filter criteria (None = all)</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">commissions</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_commissions</span><span class="p">()</span>
    <span class="n">total_commission</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;commission&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">commissions</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total commissions: $</span><span class="si">{</span><span class="n">total_commission</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_open_orders</strong>(timeout=10.0)</span></p>
<p>Request open orders for this client. Returns list of dicts with keys: <code>orderId</code>, <code>contract</code>, <code>order</code>, <code>orderState</code>. Returns empty list on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">orders</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_open_orders</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s1">&#39;contract&#39;</span><span class="p">]</span>
        <span class="n">order_info</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s1">&#39;orderState&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order </span><span class="si">{</span><span class="n">order</span><span class="p">[</span><span class="s1">&#39;orderId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">contract</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">order_info</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">order_info</span><span class="p">[</span><span class="s1">&#39;totalQuantity&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_order_status</strong>(order_id, timeout=5.0)</span></p>
<p>Retrieve latest known status for a specific order ID. Returns dict with status details or <code>None</code> if unknown.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_id</code></td>
<td><code>int</code></td>
<td>Order identifier</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Optional[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_order_status</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filled: </span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;filled&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remaining: </span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;remaining&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="contract-reference-data-methods">Contract &amp; Reference Data Methods</h3>
<p><span class="funcname"><strong>get_contract_details</strong>(contract, timeout=10.0)</span></p>
<p>Request detailed contract specifications. Returns list of dicts containing <code>contractDetails</code> objects. Returns empty list on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">details</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_contract_details</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;contractDetails&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contract: </span><span class="si">{</span><span class="n">cd</span><span class="o">.</span><span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Long Name: </span><span class="si">{</span><span class="n">cd</span><span class="o">.</span><span class="n">longName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min Tick: </span><span class="si">{</span><span class="n">cd</span><span class="o">.</span><span class="n">minTick</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_fundamental_data</strong>(contract, reportType="ReportSnapshot", timeout=10.0)</span></p>
<p>Request fundamental data (XML/text format). Returns string data or <code>None</code> on timeout/error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contract</code></td>
<td><code>Contract</code></td>
<td>IB contract object</td>
</tr>
<tr>
<td><code>reportType</code></td>
<td><code>str</code></td>
<td>Report type ("ReportSnapshot", "ReportsFinSummary", etc.)</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Optional[str]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">fundamentals</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_fundamental_data</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">reportType</span><span class="o">=</span><span class="s2">&quot;ReportSnapshot&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fundamentals</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fundamentals</span><span class="p">[:</span><span class="mi">500</span><span class="p">])</span>  <span class="c1"># Print first 500 chars</span>
</code></pre></div></p>
<hr />
<p><span class="funcname"><strong>get_news_bulletins</strong>(timeout=5.0)</span></p>
<p>Subscribe briefly to news bulletins. Returns list of bulletin dicts with keys: <code>msgId</code>, <code>msgType</code>, <code>message</code>, <code>exchange</code>. Best-effort; may return empty list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timeout</code></td>
<td><code>float</code></td>
<td>Timeout in seconds</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>List[Dict[str, Any]]</code></p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="n">bulletins</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_news_bulletins</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">bulletin</span> <span class="ow">in</span> <span class="n">bulletins</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bulletin</span><span class="p">[</span><span class="s1">&#39;msgType&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">bulletin</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h3 id="complete-usage-example">Complete Usage Example</h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">IBKR.ib_connect</span><span class="w"> </span><span class="kn">import</span> <span class="n">IB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ibapi.contract</span><span class="w"> </span><span class="kn">import</span> <span class="n">Contract</span>

<span class="c1"># Create contract</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">()</span>
<span class="n">contract</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;AAPL&quot;</span>
<span class="n">contract</span><span class="o">.</span><span class="n">secType</span> <span class="o">=</span> <span class="s2">&quot;STK&quot;</span>
<span class="n">contract</span><span class="o">.</span><span class="n">exchange</span> <span class="o">=</span> <span class="s2">&quot;SMART&quot;</span>
<span class="n">contract</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span>

<span class="c1"># Use as context manager</span>
<span class="k">with</span> <span class="n">IB</span><span class="p">()</span> <span class="k">as</span> <span class="n">ib</span><span class="p">:</span>
    <span class="c1"># Get historical data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_historical_data</span><span class="p">(</span>
        <span class="n">contract</span><span class="p">,</span>
        <span class="n">durationStr</span><span class="o">=</span><span class="s2">&quot;5 D&quot;</span><span class="p">,</span>
        <span class="n">barSizeSetting</span><span class="o">=</span><span class="s2">&quot;1 hour&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> bars&quot;</span><span class="p">)</span>

    <span class="c1"># Get current price</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_last_price</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current price: $</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get market snapshot</span>
    <span class="n">snapshot</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_market_snapshot</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bid: $</span><span class="si">{</span><span class="n">snapshot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bid&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Ask: $</span><span class="si">{</span><span class="n">snapshot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ask&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get positions</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position: </span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="s1">&#39;contract&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Qty: </span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get account summary</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_account_summary</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NetLiquidation&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Net Liquidation: $</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get executions</span>
    <span class="n">executions</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">get_executions</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total executions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">executions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Connection automatically closed when exiting context</span>
</code></pre></div>
<hr />
<h2 id="ib-objects">IB Objects</h2>
<p><code>ib_objects.py</code></p>
<p>This module provides example factory functions to create Interactive Brokers API objects (Contracts and Orders) with sensible defaults for common trading scenarios. It has not been the ambition to wrap all available object types in the IB API, but rather to provide examples of how this can be done for contract and order objects.</p>
<hr />
<h3 id="contract-function">Contract Function</h3>
<p><span class="funcname"><strong>ib_contract</strong>(symbol)</span></p>
<p>Creates an IB contract object for US stocks and ETFs. Extend this function with additional properties and logic or create additional ones for more advanced contracts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>symbol</code></td>
<td><code>str</code></td>
<td>Stock or ETF ticker symbol (e.g., "AAPL", "SPY")</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Contract</code></p>
<p><strong>Default Settings:</strong></p>
<ul>
<li><code>currency</code>: "USD"</li>
<li><code>exchange</code>: "SMART"</li>
<li><code>secType</code>: "STK" (stock)</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">IBKR.ib_objects</span><span class="w"> </span><span class="kn">import</span> <span class="n">ib_contract</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">ib_contract</span><span class="p">(</span><span class="s2">&quot;SPY&quot;</span><span class="p">)</span>
<span class="c1"># Ready to use for market data or order placement</span>

<span class="c1"># Contract can be customized further</span>
<span class="n">contract</span><span class="o">.</span><span class="n">primaryExchange</span> <span class="o">=</span> <span class="s2">&quot;ARCA&quot;</span>
</code></pre></div></p>
<hr />
<h3 id="order-functions">Order Functions</h3>
<p><span class="funcname"><strong>ib_order</strong>(quantity, order_ref='', orderType='MOC')</span></p>
<p>Creates an example IB order object with automatic buy/sell direction based on quantity sign. Extend this function with additional properties and logic or create additional ones for more advanced order types.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>quantity</code></td>
<td><code>int</code></td>
<td>Order quantity (positive = BUY, negative = SELL)</td>
</tr>
<tr>
<td><code>order_ref</code></td>
<td><code>str</code></td>
<td>Optional reference string for order tracking</td>
</tr>
<tr>
<td><code>orderType</code></td>
<td><code>str</code></td>
<td>Order type ("MOC", "MKT", "LMT", etc.)</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> <code>Order</code></p>
<p><strong>Default Settings:</strong></p>
<ul>
<li><code>action</code>: "BUY" or "SELL" (determined by quantity sign)</li>
<li><code>totalQuantity</code>: Absolute value of quantity</li>
<li><code>exchange</code>: "SMART"</li>
<li><code>eTradeOnly</code>: False</li>
<li><code>firmQuoteOnly</code>: False</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">IBKR.ib_objects</span><span class="w"> </span><span class="kn">import</span> <span class="n">ib_order</span>

<span class="c1"># Market on close buy order</span>
<span class="n">buy_order</span> <span class="o">=</span> <span class="n">ib_order</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">orderType</span><span class="o">=</span><span class="s2">&quot;MOC&quot;</span><span class="p">)</span>

<span class="c1"># Market sell order with reference</span>
<span class="n">sell_order</span> <span class="o">=</span> <span class="n">ib_order</span><span class="p">(</span><span class="n">quantity</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">order_ref</span><span class="o">=</span><span class="s2">&quot;close_position&quot;</span><span class="p">,</span> <span class="n">orderType</span><span class="o">=</span><span class="s2">&quot;MKT&quot;</span><span class="p">)</span>

<span class="c1"># Limit buy order (note: you&#39;ll need to set order.lmtPrice separately)</span>
<span class="n">limit_order</span> <span class="o">=</span> <span class="n">ib_order</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">orderType</span><span class="o">=</span><span class="s2">&quot;LMT&quot;</span><span class="p">)</span>
<span class="n">limit_order</span><span class="o">.</span><span class="n">lmtPrice</span> <span class="o">=</span> <span class="mf">150.00</span>

<span class="c1"># Stop order</span>
<span class="n">stop_order</span> <span class="o">=</span> <span class="n">ib_order</span><span class="p">(</span><span class="n">quantity</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">order_ref</span><span class="o">=</span><span class="s2">&quot;stop_loss&quot;</span><span class="p">,</span> <span class="n">orderType</span><span class="o">=</span><span class="s2">&quot;STP&quot;</span><span class="p">)</span>
<span class="n">stop_order</span><span class="o">.</span><span class="n">auxPrice</span> <span class="o">=</span> <span class="mf">145.00</span>  <span class="c1"># Stop price</span>
</code></pre></div></p>
<hr />
<h2 id="sending-an-order-to-ib">Sending an Order to IB</h2>
<p><code>ib_send_order.py</code></p>
<p>This module contains a minimal test client demonstrating order placement through Interactive Brokers with database integration. This module shows a complete workflow: connecting to IB, placing an order, and recording the transaction in a database.</p>
<p><strong>Note:</strong> This is a reference implementation. Production usage requires proper error handling, connection management, and strategy configuration.</p>
<hr />
<h3 id="client-class">Client Class</h3>
<p><code>Client(ClientBase)</code></p>
<p>A test client that sends a single order to IB and records it in the database.</p>
<p><strong>Features:</strong></p>
<ul>
<li>Inherits from <code>ClientBase</code> (Quantstrip framework)</li>
<li>Connects to IB Gateway/TWS</li>
<li>Places market order</li>
<li>Records order in database</li>
<li>Updates internal position tracking</li>
<li>Automatically disconnects and stops after execution</li>
</ul>
<hr />
<h3 id="configuration">Configuration</h3>
<h4 id="default-settings">Default Settings</h4>
<div class="highlight"><pre><span></span><code><span class="n">contract</span> <span class="o">=</span> <span class="n">ib_contract</span><span class="p">(</span><span class="s2">&quot;SPY&quot;</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">ib_order</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">orderType</span><span class="o">=</span><span class="s2">&quot;MKT&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><strong>Symbol:</strong> SPY (S&amp;P 500 ETF)</li>
<li><strong>Quantity:</strong> 100 shares (BUY)</li>
<li><strong>Order Type:</strong> Market order</li>
<li><strong>Client ID:</strong> 5 (for IB connection)</li>
</ul>
<hr />
<h3 id="workflow">Workflow</h3>
<p>The client executes the following sequence:</p>
<ol>
<li><strong>Connect to IB:</strong> Establishes connection with <code>client_id=5</code></li>
<li><strong>Get Order ID:</strong> Retrieves next available order ID from database</li>
<li><strong>Place Order:</strong> Submits order to Interactive Brokers using <code>placeOrder()</code></li>
<li><strong>Record Order:</strong> Inserts order details into database orders table</li>
<li><strong>Update Position:</strong> Inserts strategy event into database</li>
<li><strong>Disconnect:</strong> Closes IB connection</li>
<li><strong>Stop Client:</strong> Terminates the client process</li>
</ol>
<hr />
<h3 id="database-integration">Database Integration</h3>
<h4 id="order-record">Order Record</h4>
<div class="highlight"><pre><span></span><code><span class="n">db_handler</span><span class="o">.</span><span class="n">insert_order</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>      <span class="c1"># Test Strategy</span>
    <span class="n">broker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>        <span class="c1"># IB broker</span>
    <span class="n">account</span><span class="o">=</span><span class="s2">&quot;U1234567&quot;</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;SPY&quot;</span><span class="p">,</span>
    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
    <span class="n">order_type</span><span class="o">=</span><span class="s2">&quot;MKT&quot;</span><span class="p">,</span>
    <span class="n">total_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">instrument_type</span><span class="o">=</span><span class="s2">&quot;STK&quot;</span><span class="p">,</span>
    <span class="n">client_reference</span><span class="o">=</span><span class="s2">&quot;test_order&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="strategy-event-record">Strategy Event Record</h4>
<div class="highlight"><pre><span></span><code><span class="n">db_handler</span><span class="o">.</span><span class="n">insert_strategy_event</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;test_client&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="prerequisites">Prerequisites</h3>
<h4 id="database-setup">Database Setup</h4>
<p>A strategy must exist in the database strategy table before running:
<div class="highlight"><pre><span></span><code><span class="c1">-- Example: Ensure strategy_id=1 exists</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">strategy</span><span class="w"> </span><span class="p">(</span><span class="n">strategy_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test Strategy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Testing order placement&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h4 id="ib-connection">IB Connection</h4>
<ul>
<li>IB Gateway or TWS must be running</li>
<li>API connections must be enabled</li>
<li>Default port: 7497 (paper trading) or 7496 (live)</li>
</ul>
<hr />
<h3 id="usage-example">Usage Example</h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ib_send_order</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

<span class="c1"># Initialize and run client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p><strong>Scheduler Behavior:</strong></p>
<ul>
<li>Job runs once after 1 second</li>
<li>Client automatically stops after execution</li>
<li>Use for testing or one-time order placement</li>
</ul>
<hr />
<h3 id="customization">Customization</h3>
<h4 id="different-symbolquantity">Different Symbol/Quantity</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># At module level, before Client definition</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">ib_contract</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">ib_order</span><span class="p">(</span><span class="n">quantity</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">orderType</span><span class="o">=</span><span class="s2">&quot;MKT&quot;</span><span class="p">)</span>  <span class="c1"># Sell 50 shares</span>
</code></pre></div>
<h4 id="different-strategy">Different Strategy</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># In job() method</span>
<span class="n">db_handler</span><span class="o">.</span><span class="n">insert_order</span><span class="p">(</span>
    <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
    <span class="n">strategy_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Change to your strategy ID</span>
    <span class="c1"># ... rest of parameters</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="continuous-operation">Continuous Operation</h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Client</span><span class="p">(</span><span class="n">ClientBase</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Run every hour instead of once</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ... order placement logic ...</span>
        <span class="c1"># Remove self.stop_client() to keep running</span>
</code></pre></div>
<hr />
<h3 id="error-handling">Error Handling</h3>
<p>The client includes try-catch-finally structure:</p>
<ul>
<li><strong>Try:</strong> Execute order placement and database operations</li>
<li><strong>Catch:</strong> Log errors with full traceback</li>
<li><strong>Finally:</strong> Always disconnect from IB (prevents connection leaks)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="c1"># Order placement logic</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">disconnect_client</span><span class="p">()</span>
</code></pre></div>
<hr />
<h3 id="important-notes">Important Notes</h3>
<div class="admonition warning">
<p class="admonition-title">Production Considerations</p>
<ul>
<li>This is a test/reference implementation</li>
<li>Add proper validation and error recovery for production use</li>
<li>Consider order status confirmation before database insertion</li>
<li>Implement retry logic for connection failures</li>
<li>Add position reconciliation checks</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Database Requirements</p>
<ul>
<li>`strategy_id=1</li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="templates_general.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: About examples">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                About examples
              </div>
            </div>
          </a>
        
        
          
          <a href="../API/quantstrip.html" class="md-footer__link md-footer__link--next" aria-label="Next: quantstrip">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                quantstrip
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>